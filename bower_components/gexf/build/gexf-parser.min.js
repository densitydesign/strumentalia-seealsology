/* gexf-parser.js - Gexf parser for JavaScript. - Version: 0.2.2 - Author: Guillaume Plique - medialab SciencesPo */
(function(e){"use strict";function t(e){var t={id:e.id,label:e.label};return e.viz&&(t.viz=e.viz),e.attributes&&(t.attributes=e.attributes),t}function n(e){var t={id:e.id,type:e.type||"undirected",label:e.label||"",source:e.source,target:e.target,weight:+e.weight||1};return e.viz&&(t.viz=e.viz),e.attributes&&(t.attributes=e.attributes),t}function r(e){function r(){var e={};return d.els.meta?(e.lastmodifieddate=d.els.meta.getAttribute("lastmodifieddate"),u.nodeListEach(d.els.meta.childNodes,function(t){e[t.tagName.toLowerCase()]=t.textContent}),e):e}function i(e){var t=[];return d.els.model[e]&&u.nodeListEach(d.els.model[e],function(e){var n={id:e.getAttribute("id")||e.getAttribute("for"),type:e.getAttribute("type")||"string",title:e.getAttribute("title")||""},r=u.nodeListToArray(e.childNodes);r.length>0&&(n.defaultValue=r[0].textContent),t.push(n)}),t.length>0?t:!1}function a(e,t){var n={},r=t.getElementsByTagName("attvalue"),i=u.nodeListToHash(r,function(e){var t=u.namedNodeMapToObject(e.attributes),n=t.id||t["for"];return{key:n,value:t.value}});return e.map(function(e){n[e.id]=!(e.id in i)&&"defaultValue"in e?u.enforceType(e.type,e.defaultValue):u.enforceType(e.type,i[e.id])}),n}function o(e){var n=[];return u.nodeListEach(d.els.nodes,function(r){var i={id:r.getAttribute("id"),label:r.getAttribute("label")||""};e&&(i.attributes=a(e,r)),d.hasViz&&(i.viz=s(r)),n.push(t(i))}),n}function s(e){var t={},n=u.getFirstElementByTagNS(e,"viz","color");if(n){var r=["r","g","b","a"].map(function(e){return n.getAttribute(e)});t.color=u.getRGB(r)}var i=u.getFirstElementByTagNS(e,"viz","position");i&&(t.position={},["x","y","z"].map(function(e){t.position[e]=+i.getAttribute(e)}));var a=u.getFirstElementByTagNS(e,"viz","size");a&&(t.size=+a.getAttribute("value"));var o=u.getFirstElementByTagNS(e,"viz","shape");return o&&(t.shape=o.getAttribute("value")),t}function l(e,t){var r=[];return u.nodeListEach(d.els.edges,function(i){var o=u.namedNodeMapToObject(i.attributes);"type"in o||(o.type=t),e&&(o.attributes=a(e,i)),d.hasViz&&(o.viz=g(i)),r.push(n(o))}),r}function g(e){var t={},n=u.getFirstElementByTagNS(e,"viz","color");if(n){var r=["r","g","b","a"].map(function(e){return n.getAttribute(e)});t.color=u.getRGB(r)}var i=u.getFirstElementByTagNS(e,"viz","shape");i&&(t.shape=i.getAttribute("value"));var a=u.getFirstElementByTagNS(e,"viz","thickness");return a&&(t.thickness=+a.getAttribute("value")),t}var d={};d.els={root:e.getElementsByTagName("gexf")[0],graph:e.getElementsByTagName("graph")[0],meta:e.getElementsByTagName("meta")[0],nodes:e.getElementsByTagName("node"),edges:e.getElementsByTagName("edge"),model:u.getModelTags(e)},d.hasViz=!!u.getAttributeNS(d.els.root,"xmlns","viz"),d.version=d.els.root.getAttribute("version")||"1.0",d.mode=d.els.graph.getAttribute("mode")||"static";var f=d.els.graph.getAttribute("defaultedgetype");d.defaultEdgetype=f||"undirected";var c=i("node"),m=i("edge"),v={version:d.version,mode:d.mode,defaultEdgeType:d.defaultEdgetype,meta:r(),model:{},nodes:o(c),edges:l(m,d.defaultEdgetype)};return c&&(v.model.node=c),m&&(v.model.edge=m),v}function i(e,t){var n=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;var e,t;if(window.ActiveXObject){e=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(t in e)try{return new ActiveXObject(e[t])}catch(n){}}return null}();if(!n)throw"XMLHttpRequest not supported, cannot load the file.";var r,i="function"==typeof t;return n.overrideMimeType?(n.overrideMimeType("text/xml"),r=function(e){return e.responseXML}):r=function(e){var t=new DOMParser;return t.parseFromString(e.responseText,"application/xml")},n.open("GET",e,i),i&&(n.onreadystatechange=function(){4===n.readyState&&t(r(n))}),n.send(),i?n:r(n)}function a(e){return r(e)}function o(e,t){return"function"==typeof t?i(e,function(e){t(r(e))}):r(i(e))}var u={getModelTags:function(e){var t,n=e.getElementsByTagName("attributes"),r={},i=n.length;for(t=0;i>t;t++)r[n[t].getAttribute("class")]=n[t].childNodes;return r},nodeListToArray:function(e){for(var t=[],n=0,r=e.length;r>n;++n)"#text"!==e[n].nodeName&&t.push(e[n]);return t},nodeListEach:function(e,t){for(var n=0,r=e.length;r>n;++n)"#text"!==e[n].nodeName&&t(e[n])},nodeListToHash:function(e,t){for(var n={},r=0;r<e.length;r++)if("#text"!==e[r].nodeName){var i=t(e[r]);n[i.key]=i.value}return n},namedNodeMapToObject:function(e){for(var t={},n=0;n<e.length;n++)t[e[n].name]=e[n].value;return t},getFirstElementByTagNS:function(e,t,n){var r=e.getElementsByTagName(t+":"+n)[0];return r||(r=e.getElementsByTagNameNS(t,n)[0]),r||(r=e.getElementsByTagName(n)[0]),r},getAttributeNS:function(t,n,r){var i=t.getAttribute(n+":"+r);return i===e&&(i=t.getAttributeNS(n,r)),i===e&&(i=t.getAttribute(r)),i},enforceType:function(e,t){switch(e){case"boolean":t="true"===t;break;case"integer":case"long":case"float":case"double":t=+t;break;case"liststring":t=t?t.split("|"):[]}return t},getRGB:function(e){return e[3]?"rgba("+e.join(",")+")":"rgb("+e.slice(0,-1).join(",")+")"}},s={parse:a,fetch:o,version:"0.2.2"};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports.gexf=s):"function"==typeof define&&define.amd?define("gexf",[],function(){return s}):"undefined"!=typeof this.gexf?(this.gexf.parse=a,this.gexf.fetch=o):this.gexf=s}).call(this);